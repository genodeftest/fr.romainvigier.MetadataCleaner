app-id: fr.romainvigier.MetadataCleaner
runtime: org.gnome.Platform
runtime-version: '40'
sdk: org.gnome.Sdk
command: metadata-cleaner
finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --device=dri

cleanup:
  - /include
  - /lib/pkgconfig
  - /share/doc
  - /share/man
  - '*.a'
  - '*.la'

modules:

  - name: ffmpeg
    buildsystem: autotools
    sources:
      - type: git
        url: https://git.ffmpeg.org/ffmpeg.git
        tag: n4.4
        commit: dc91b913b6260e85e1304c74ff7bb3c22a8c9fb1
        x-checker-data:
          type: git
          tag-pattern: ^n([\d\.]+)$

  - name: perl
    buildsystem: simple
    build-commands:
      - ./Configure -des -Dprefix=$FLATPAK_DEST
      - make
      - make install
    post-install:
      # Fix wrong permissions
      - chmod -R u+w $FLATPAK_DEST/lib/perl5
    sources:
      - type: archive
        url: https://www.cpan.org/src/5.0/perl-5.32.1.tar.gz
        sha256: 03b693901cd8ae807231b1787798cf1f2e0b8a56218d07b7da44f784a7caeb2c
        x-checker-data:
          type: html
          url: https://www.perl.org/
          version-pattern: <span class="version-highlight">([\d\.]+)</span>
          url-template: https://www.cpan.org/src/$major.0/perl-$version.tar.gz

  - name: exiftool
    buildsystem: simple
    build-commands:
      - perl Makefile.PL
      - make install
    sources:
      - type: archive
        url: https://exiftool.org/Image-ExifTool-12.25.tar.gz
        sha256: 97821df046ef24c04e1dd5855847a9db768193c9e6471fbd5145e1e6e3a37887
        x-checker-data:
          type: html
          url: https://exiftool.org/rss.xml
          pattern: (https://exiftool.org/Image-ExifTool-([\d\.]+).tar.gz)

  - name: poppler
    buildsystem: cmake
    sources:
      - type: git
        url: https://anongit.freedesktop.org/git/poppler/poppler.git
        tag: poppler-21.05.0
        commit: 7961ff99df6db70319548b07249194cabfc74783
        x-checker-data:
          type: git
          tag-pattern: ^poppler-([\d\.]+)$

  - name: python3-mutagen
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --optimize=1 --single-version-externally-managed
        --prefix=$FLATPAK_DEST --root=/
    ensure-writable:
      - /lib/python3*/site-packages/easy-install.pth
    sources:
      - type: git
        url: https://github.com/quodlibet/mutagen.git
        tag: release-1.45.1
        commit: 07108702b18d373d883ee9a36d2dd1066e621a0c
        x-checker-data:
          type: git
          tag-pattern: ^release-([\d\.]+)$

  - name: python3-libmat2
    buildsystem: simple
    build-commands:
      - python3 setup.py build
      - python3 setup.py install --optimize=1 --single-version-externally-managed
        --prefix=$FLATPAK_DEST --root=/
    ensure-writable:
      - /lib/python3*/site-packages/easy-install.pth
    sources:
      - type: git
        url: https://0xacab.org/jvoisin/mat2.git
        tag: 0.12.1
        commit: c5841a241dcf737599422e34a99d8001f974d13a
        x-checker-data:
          type: git
          tag-pattern: ^([\d\.]+)$

  - name: media-types
    buildsystem: simple
    build-commands:
      - install -D mime.types $FLATPAK_DEST/share/
    sources:
      - type: git
        url: https://salsa.debian.org/debian/media-types.git
        tag: 4.0.0
        commit: 0693ea7ac0d276c9c8dbae86e1b6c011443d7078
        x-checker-data:
          type: git
          tag-pattern: ^([\d\.]+)$

  - name: metadata-cleaner
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.com/rmnvgr/metadata-cleaner.git
        tag: v1.0.6
        commit: 733438fc325e38623aab8224067bbf3b2e28193b
        x-checker-data:
          type: git
          tag-pattern: ^v([\d\.]+)$
